{
    "patch": "diff --git a/pygments/lexers/c_like.py b/pygments/lexers/c_like.py\nindex f5073c74..f6e0fa70 100644\n--- a/pygments/lexers/c_like.py\n+++ b/pygments/lexers/c_like.py\n@@ -305,19 +305,23 @@ class CudaLexer(CLexer):\n \n     def get_tokens_unprocessed(self, text, stack=('root',)):\n         for index, token, value in CLexer.get_tokens_unprocessed(self, text, stack):\n-            if token is Name:\n-                if value in self.variable_qualifiers:\n-                    token = Keyword.Type\n-                elif value in self.vector_types:\n-                    token = Keyword.Type\n-                elif value in self.variables:\n-                    token = Name.Builtin\n-                elif value in self.execution_confs:\n-                    token = Keyword.Pseudo\n-                elif value in self.function_qualifiers:\n-                    token = Keyword.Reserved\n-                elif value in self.functions:\n-                    token = Name.Function\n+            # Remap CUDA-specific tokens.\n+            #\n+            # Important: keep the original *index* from the underlying lexer.\n+            # Off-by-one errors here break formatters that rely on token\n+            # positions (e.g. for error underlines or other overlays).\n+            if value in self.variable_qualifiers:\n+                token = Keyword.Type\n+            elif value in self.vector_types:\n+                token = Keyword.Type\n+            elif value in self.variables:\n+                token = Name.Builtin\n+            elif value in self.execution_confs and token is Operator:\n+                token = Keyword.Pseudo\n+            elif value in self.function_qualifiers:\n+                token = Keyword.Reserved\n+            elif value in self.functions:\n+                token = Name.Function\n             yield index, token, value\n \n \n@@ -523,14 +527,16 @@ class ArduinoLexer(CppLexer):\n \n     def get_tokens_unprocessed(self, text, stack=('root',)):\n         for index, token, value in CppLexer.get_tokens_unprocessed(self, text, stack):\n-            if value in self.structure:\n-                yield index, Name.Builtin, value\n-            elif value in self.operators:\n-                yield index, Operator, value\n+            # Keep original indices; only remap token types for Arduino-specific\n+            # identifiers/operators.\n+            if value in self.suppress_highlight:\n+                yield index, Name, value\n             elif value in self.variables:\n                 yield index, Keyword.Reserved, value\n-            elif value in self.suppress_highlight:\n-                yield index, Name, value\n+            elif value in self.operators:\n+                yield index, Operator, value\n+            elif value in self.structure:\n+                yield index, Name.Builtin, value\n             elif value in self.functions:\n                 yield index, Name.Function, value\n             else:\n",
    "success": false,
    "steps": 24,
    "estimated_tokens": 22368
}