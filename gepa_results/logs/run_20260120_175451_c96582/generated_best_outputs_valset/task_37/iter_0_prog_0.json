{
    "patch": "diff --git a/pygments/formatters/html.py b/pygments/formatters/html.py\nindex 3330c1d5..57b3f9af 100644\n--- a/pygments/formatters/html.py\n+++ b/pygments/formatters/html.py\n@@ -37,6 +37,8 @@ _escape_html_table = {\n \n def escape_html(text, table=_escape_html_table):\n     \"\"\"Escape &, <, > as well as single and double quotes for HTML.\"\"\"\n+    if text is None:\n+        return ''\n     return text.translate(table)\n \n \n@@ -863,7 +865,7 @@ class HtmlFormatter(Formatter):\n                 filename, linenumber = self._lookup_ctag(value)\n                 if linenumber:\n                     base, filename = os.path.split(filename)\n-                    if base:\n+                    if not base:\n                         base += '/'\n                     filename, extension = os.path.splitext(filename)\n                     url = self.tagurlformat % {'path': base, 'fname': filename,\n@@ -898,7 +900,6 @@ class HtmlFormatter(Formatter):\n             elif parts[-1]:\n                 line = [cspan, parts[-1]]\n                 lspan = cspan\n-            # else we neither have to open a new span nor set lspan\n \n         if line:\n             line.extend(((lspan and '</span>'), lsep))\ndiff --git a/tests/test_html_formatter.py b/tests/test_html_formatter.py\nindex ca3d35da..20f62e67 100644\n--- a/tests/test_html_formatter.py\n+++ b/tests/test_html_formatter.py\n@@ -269,3 +269,18 @@ def test_debug_token_types():\n     fmt_debug_token_types.format(tokensource, outfile_debug_token_types)\n     html_debug_token_types = outfile_debug_token_types.getvalue()\n     assert '<span class=\"n\" title=\"Name\">TESTDIR</span>' in html_debug_token_types\n+\n+def test_html_formatter_default_produces_visible_output():\n+    code = 'def hello_world():\\n    print(\"Hello, World!\")\\n    return True\\n'\n+    tokens = list(PythonLexer().get_tokens(code))\n+\n+    fmt = HtmlFormatter()\n+    out = StringIO()\n+    fmt.format(tokens, out)\n+    html = out.getvalue()\n+\n+    # Regression: formatter must not return empty or wrapper-only output.\n+    assert '<div class=\"highlight\">' in html\n+    assert '<pre>' in html\n+    assert 'hello_world' in html\n+    assert 'print' in html\n",
    "success": false,
    "steps": 18,
    "estimated_tokens": 19658
}