{
    "patch": "diff --git a/pygments/formatters/rtf.py b/pygments/formatters/rtf.py\nindex 7f8b7e4c..d72f74f6 100644\n--- a/pygments/formatters/rtf.py\n+++ b/pygments/formatters/rtf.py\n@@ -158,33 +158,36 @@ class RtfFormatter(Formatter):\n                    .replace('}', '\\\\}')\n \n     def _escape_text(self, text):\n-        # empty strings, should give a small performance improvement\n         if not text:\n             return ''\n \n-        # escape text\n         text = self._escape(text)\n \n         buf = []\n         for c in text:\n             cn = ord(c)\n-            if cn < (2**7):\n-                # ASCII character\n-                buf.append(str(c))\n-            elif (2**7) <= cn < (2**16):\n-                # single unicode escape sequence\n+            # RTF is ASCII; non-ASCII characters must be emitted using\n+            # \\uN escapes. Plain ASCII should be kept as-is (after escaping\n+            # RTF control characters above).\n+            if cn < 128:\n+                buf.append(c)\n+            elif cn < 0x10000:\n                 buf.append('{\\\\u%d}' % cn)\n-            elif (2**16) <= cn:\n-                # RTF limits unicode to 16 bits.\n-                # Force surrogate pairs\n-                buf.append('{\\\\u%d}{\\\\u%d}' % surrogatepair(cn))\n+            else:\n+                # Encode as UTF-16 surrogate pair.\n+                hi, lo = surrogatepair(cn)\n+                buf.append('{\\\\u%d}{\\\\u%d}' % (hi, lo))\n \n+        # Newlines are paragraphs in RTF.\n         return ''.join(buf).replace('\\n', '\\\\par')\n \n     @staticmethod\n     def hex_to_rtf_color(hex_color):\n-        if hex_color[0] == \"#\":\n+        # Accept '#RRGGBB' and 'RRGGBB'\n+        if hex_color.startswith(\"#\"):\n             hex_color = hex_color[1:]\n+        if len(hex_color) != 6:\n+            raise ValueError(f\"Invalid hex color {hex_color!r}\")\n \n         return '\\\\red%d\\\\green%d\\\\blue%d;' % (\n                         int(hex_color[0:2], 16),\n",
    "success": false,
    "steps": 19,
    "estimated_tokens": 13709
}